<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Book Summarizer</title>
  <style>
    :root {
      --bg:   #0f0f0f;
      --fg:   #ffffff;
      --muted:#888888;
      --border:#444444;
      --error: #ff6b6b;
    }
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      background: var(--bg);
      color: var(--fg);
      font-family: 'JetBrains Mono', monospace;
      display: flex; flex-direction: column;
      align-items: center; justify-content: center;
      height: 100vh; text-align: center;
    }

    h1 { font-size: 2rem; margin-bottom: .5rem; }
    p  { color: var(--muted); margin-bottom: 1rem; }

    /* â€”â€” CONTROL WRAPPER â€”â€” */
    .controls {
      width: 320px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: .5rem;
    }

    /* â€”â€” Drag-Drop Zone â€”â€” */
    #drop-zone {
      border: 2px dashed var(--border);
      border-radius: 6px;
      width: 100%; padding: 2rem;
      display: flex; flex-direction: column; align-items: center; gap: .5rem;
      color: var(--muted);
      transition: background .3s, border-color .3s, color .3s;
      cursor: pointer;
    }
    #drop-zone.dragover {
      background: #222; border-color: var(--fg); color: var(--fg);
    }
    #drop-zone svg {
      fill: var(--muted); width: 32px; height: 32px;
      transition: fill .3s;
    }
    #drop-zone.dragover svg { fill: var(--fg); }
    #drop-zone input { display: none; }

    /* â€”â€” File info & clear â€”â€” */
    #file-info {
      font-size: .9rem; color: var(--muted);
      display: flex; align-items: center; gap: .5rem;
      word-break: break-all;
      width: 100%;
      justify-content: center;
    }
    #clear-btn {
      background: none; border: none;
      color: var(--error); font-size: 1.2rem;
      cursor: pointer; visibility: hidden;
    }

    /* â€”â€” Length selector â€”â€” */
    #length-control {
      display: flex; gap: .5rem;
    }
    .length-btn {
      padding: .5rem 1rem;
      background: none; border:1px solid var(--fg);
      color: var(--fg); border-radius: 4px;
      cursor: pointer; transition: background .3s, color .3s;
      font-size: .9rem;
    }
    .length-btn.active {
      background: var(--fg); color: var(--bg);
    }

    /* â€”â€” Summarize button â€”â€” */
    #summarize-btn {
      padding: .75rem 1.5rem;
      background: var(--fg); color: var(--bg);
      border: none; border-radius: 6px;
      cursor: pointer; transition: opacity .3s;
    }
    #summarize-btn:disabled {
      opacity: .5; cursor: not-allowed;
    }

    /* â€”â€” Progress bar container â€”â€” */
    #progress-container {
      width: 100%; height: 6px;
      background: var(--border); border-radius:3px;
      overflow: hidden; margin-top: .5rem;
      display: none;
    }
    #progress-bar {
      width: 0%; height: 100%;
      background: var(--fg); transition: width .3s;
    }

    /* â€”â€” Loading overlay â€”â€” */
    #loading-overlay {
      position: fixed; top:0; left:0;
      width:100%; height:100%;
      background:rgba(0,0,0,0.8);
      display:flex; align-items:center; justify-content:center;
      visibility:hidden; opacity:0;
      transition:opacity .3s; z-index:2000;
    }
    #loading-overlay.show {
      visibility:visible; opacity:1;
    }
    .spinner {
      border:8px solid var(--border);
      border-top:8px solid var(--fg);
      border-radius:50%; width:60px; height:60px;
      animation:spin .8s linear infinite;
    }
    @keyframes spin { to{transform:rotate(360deg);} }

    /* â€”â€” Modal â€”â€” */
    #summary-modal {
      position:fixed; top:50%; left:50%;
      transform:translate(-50%,-50%);
      background:var(--bg); color:var(--fg);
      width:90%; max-width:500px; max-height:70vh;
      border-radius:8px; display:flex; flex-direction:column;
      visibility:hidden; opacity:0; transition:opacity .3s;
      z-index:3000;
    }
    #summary-modal.show {
      visibility:visible; opacity:1;
    }
    .modal-header {
      display:flex; justify-content:space-between; align-items:center;
      padding:1rem; border-bottom:1px solid var(--border);
    }
    .modal-header h2 { margin:0; font-size:1.25rem; }
    .close-btn {
      background:none; border:none;
      color:var(--fg); font-size:1.5rem; cursor:pointer;
    }
    #summary-content {
      padding:1rem; overflow-y:auto;
      white-space:pre-wrap; line-height:1.5; flex:1; font-size:.95rem;
    }
    .modal-footer {
      padding:.75rem 1rem; border-top:1px solid var(--border);
      display:flex; gap:.5rem; justify-content:flex-end;
    }
    .modal-footer button {
      padding:.5rem 1rem; background:var(--fg);
      color:var(--bg); border:none; border-radius:4px;
      cursor:pointer; font-size:.9rem;
    }

    /* â€”â€” Footer â€”â€” */
    footer {
      position:absolute; bottom:15px;
      font-size:.75rem; color:var(--muted);
    }
  </style>
</head>
<body>

  <h1>AI Book Summarizer</h1>
  <p>Summarize any book in minutes.</p>

  <div class="controls">
    <label id="drop-zone" tabindex="0" aria-describedby="file-info">
      <svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7z"/><path d="M5 18h14v2H5z"/></svg>
      <span>Click or Drop a PDF/EPUB here</span>
      <input type="file" id="file-input" accept=".pdf,.epub"/>
    </label>

    <div id="file-info" role="status"></div>
    <button id="clear-btn" aria-label="Clear file">Ã—</button>

    <div id="length-control" role="radiogroup" aria-label="Summary length">
      <button type="button" class="length-btn" data-length="short">Short</button>
      <button type="button" class="length-btn active" data-length="medium">Medium</button>
      <button type="button" class="length-btn" data-length="long">Long</button>
    </div>

    <button id="summarize-btn" disabled>Summarize</button>
    <div id="progress-container"><div id="progress-bar"></div></div>
  </div>

  <div id="loading-overlay"><div class="spinner"></div></div>

  <div id="summary-modal" role="dialog" aria-modal="true" aria-labelledby="modal-title">
    <div class="modal-header">
      <h2 id="modal-title">Summary</h2>
      <button class="close-btn" id="modal-close" aria-label="Close summary">Ã—</button>
    </div>
    <div id="summary-content"></div>
    <div class="modal-footer">
      <button id="copy-btn">Copy</button>
      <button id="download-btn">Download</button>
    </div>
  </div>

  <footer>Â© 2025 | Built by You</footer>

  <script>
    // Grab elements
    const dropZone       = document.getElementById('drop-zone');
    const fileInput      = document.getElementById('file-input');
    const fileInfo       = document.getElementById('file-info');
    const clearBtn       = document.getElementById('clear-btn');
    const lengthBtns     = document.querySelectorAll('.length-btn');
    const summarizeBtn   = document.getElementById('summarize-btn');
    const progressCont   = document.getElementById('progress-container');
    const progressBar    = document.getElementById('progress-bar');
    const loadingOverlay = document.getElementById('loading-overlay');
    const summaryModal   = document.getElementById('summary-modal');
    const modalClose     = document.getElementById('modal-close');
    const summaryContent = document.getElementById('summary-content');
    const copyBtn        = document.getElementById('copy-btn');
    const downloadBtn    = document.getElementById('download-btn');

    let selectedFile = null,
        lastSummary  = '',
        summaryLength= 'medium';

    // Drag & drop
    ['dragenter','dragover'].forEach(e=>
      dropZone.addEventListener(e, ev=>{
        ev.preventDefault(); dropZone.classList.add('dragover');
      }))
    ['dragleave','drop'].forEach(e=>
      dropZone.addEventListener(e, ev=>{
        ev.preventDefault(); dropZone.classList.remove('dragover');
      }))
    dropZone.addEventListener('drop', ev=>{
      if(ev.dataTransfer.files.length) handleFile(ev.dataTransfer.files[0]);
    });
    dropZone.addEventListener('click', ()=> fileInput.click());
    dropZone.addEventListener('keydown', ev=>{
      if(ev.key==='Enter'||ev.key===' ') fileInput.click();
    });
    fileInput.addEventListener('change', ()=> {
      if(fileInput.files.length) handleFile(fileInput.files[0]);
    });

    // Clear file
    clearBtn.addEventListener('click', ()=>{
      selectedFile=null; fileInput.value='';
      fileInfo.textContent='';
      summarizeBtn.disabled=true;
      clearBtn.style.visibility='hidden';
    });

    function handleFile(file){
      selectedFile=file;
      fileInfo.textContent=`ðŸ“„ ${file.name} (${(file.size/1e6).toFixed(2)} MB)`;
      summarizeBtn.disabled=false;
      clearBtn.style.visibility='visible';
    }

    // Length selector
    lengthBtns.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        lengthBtns.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        summaryLength=btn.dataset.length;
      });
    });

    // Summarize
    summarizeBtn.addEventListener('click', async ()=>{
      if(!selectedFile) return;
      summarizeBtn.disabled=true;
      progressCont.style.display='block';
      progressBar.style.width='0%';
      summaryContent.textContent='';
      summaryModal.classList.remove('show');

      const fd = new FormData(); 
      fd.append('file', selectedFile);
      fd.append('length', summaryLength);

      // fake progress
      let pct=0;
      const timer = setInterval(()=>{
        pct = Math.min(pct + Math.random()*20, 85);
        progressBar.style.width=pct+'%';
      },300);

      try {
        const res = await fetch('https://book-summarizer-backend.onrender.com/upload',{
          method:'POST', body: fd
        });
        const data = await res.json();
        lastSummary = data.summary||data.excerpt||'No summary available.';
        summaryContent.textContent=lastSummary;
        clearInterval(timer);
        progressBar.style.width='100%';
        setTimeout(()=> progressCont.style.display='none',200);
        summaryModal.classList.add('show');
      } catch(err) {
        clearInterval(timer);
        progressCont.style.display='none';
        console.error(err);
        alert('Error summarizing file.');
      } finally {
        summarizeBtn.disabled=false;
      }
    });

    // Modal close
    modalClose.addEventListener('click', ()=> summaryModal.classList.remove('show'));
    window.addEventListener('keydown', ev=> ev.key==='Escape' && summaryModal.classList.remove('show'));
    window.addEventListener('click', ev=> ev.target===summaryModal && summaryModal.classList.remove('show'));

    // Copy & download
    copyBtn.addEventListener('click', ()=>{
      navigator.clipboard.writeText(lastSummary)
        .then(()=> alert('Copied!'))
        .catch(()=> alert('Copy failed.'));
    });
    downloadBtn.addEventListener('click', ()=>{
      const blob = new Blob([lastSummary],{type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = (selectedFile?.name||'summary')+'.txt';
      a.click();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
