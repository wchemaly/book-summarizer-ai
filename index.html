<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>AI Book Summarizer</title>
  <style>
    /* â€”â€” Reset & Full-screen Background â€”â€” */
    * { box-sizing: border-box; margin:0; padding:0 }
    html, body {
      width:100%; height:100%;
      background: url('background.jpg') center/cover no-repeat;
      font-family: 'Courier New', monospace;
      overflow: hidden;
    }

    /* â€”â€” Floating Dialog â€”â€” */
    .dialog {
      position: absolute;
      top:50%; left:50%;
      transform: translate(-50%,-50%);
      width: 360px;
      border: 2px solid #FFF;
      background: rgba(0,0,0,0.85);
      color: #FFF;
      box-shadow: 4px 4px 0 rgba(0,0,0,0.9);
    }
    .dialog .header {
      background: #FFF;
      color: #000;
      padding: 6px 10px;
      font-size: 0.9rem;
      display: flex; justify-content: space-between; align-items: center;
    }
    .dialog .header .btn {
      width:12px; height:12px;
      border:1px solid #000; background:#000; cursor:pointer;
      margin-left:4px;
    }

    .dialog .body {
      padding: 16px;
      display:flex; flex-direction: column; align-items:center;
      gap:12px;
    }

    h1 { font-size:1.2rem; }
    p  { font-size:0.85rem; color:#CCC; }

    /* â€”â€” Drop Zone â€”â€” */
    #drop-zone {
      width:100%; padding:24px;
      border:2px dashed #AAA; border-radius:4px;
      text-align:center; cursor:pointer;
      transition: background .2s, border-color .2s;
    }
    #drop-zone.dragover {
      background: rgba(255,255,255,0.1);
      border-color: #FFF;
    }
    #drop-zone input { display:none }

    /* â€”â€” File Info & Clear â€”â€” */
    #file-info {
      font-size:0.75rem; color:#CCC;
      display:flex; align-items:center; gap:4px;
      width:100%; word-break:break-all;
    }
    #clear-btn {
      background:none; border:none; color:#CCC;
      font-weight:bold; cursor:pointer;
      visibility:hidden;
    }
    #file-info.visible + #clear-btn {
      visibility: visible;
    }

    /* â€”â€” Length Toggles & Summarize Button â€”â€” */
    .controls {
      display:flex; gap:4px; width:100%;
    }
    .length-btn {
      flex:1; padding:6px 0;
      background: #000; color:#FFF;
      border:1px solid #FFF; cursor:pointer;
      font-size:0.8rem;
      transition: background .2s, color .2s;
    }
    .length-btn.active {
      background:#FFF; color:#000;
    }
    #summarize-btn {
      margin-top:8px; width:100%;
      padding:8px 0;
      background:#FFF; color:#000;
      border:none; cursor:pointer;
      font-size:0.9rem;
      transition: opacity .2s;
    }
    #summarize-btn:disabled {
      opacity:0.4; cursor:not-allowed;
    }

    /* â€”â€” Loader Overlay â€”â€” */
    #loading {
      position: fixed; top:0; left:0;
      width:100%; height:100%;
      background: rgba(0,0,0,0.7);
      display:flex;justify-content:center;align-items:center;
      visibility:hidden; opacity:0;
      transition: opacity .2s;
      z-index:10;
    }
    #loading.show {
      visibility:visible; opacity:1;
    }
    .spinner {
      border:6px solid #555;
      border-top:6px solid #FFF;
      border-radius:50%;
      width:48px; height:48px;
      animation: spin .8s linear infinite;
    }
    @keyframes spin { to { transform:rotate(360deg) } }

    /* â€”â€” Summary Modal â€”â€” */
    #summary-modal {
      position:fixed; top:50%; left:50%;
      transform:translate(-50%,-50%);
      width:80%; max-width:400px;
      background:#000; border:2px solid #FFF; border-radius:4px;
      visibility:hidden; opacity:0; transition: opacity .2s;
      z-index:20; display:flex;flex-direction:column;
    }
    #summary-modal.show {
      visibility:visible; opacity:1;
    }
    .modal-header {
      background:#FFF; color:#000;
      padding:6px 10px;
      display:flex;justify-content:space-between;align-items:center;
      font-size:0.9rem;
      border-bottom:2px solid #FFF;
    }
    .modal-header .close-btn {
      background:none; border:none; font-size:1rem; cursor:pointer;
    }
    .modal-body {
      padding:10px; color:#FFF;
      font-size:0.85rem; line-height:1.4;
      max-height:60vh; overflow-y:auto;
      white-space:pre-wrap;
    }
    .modal-footer {
      display:flex; justify-content:flex-end;
      padding:6px 10px; gap:6px;
      border-top:2px solid #FFF;
    }
    .modal-footer button {
      padding:4px 8px; background:#FFF; color:#000;
      border:none; cursor:pointer; font-size:0.8rem;
    }
  </style>
</head>
<body>

  <!-- Summarizer Window -->
  <div class="dialog">
    <div class="header">
      <span>PROJECT.EXE</span>
      <div>
        <div class="btn"></div>
        <div class="btn"></div>
        <div class="btn"></div>
      </div>
    </div>
    <div class="body">
      <h1>AI Book Summarizer</h1>
      <p>Summarize any book in minutes.</p>

      <label id="drop-zone">
        <span>ðŸ“„ Click or drop a PDF/EPUB</span>
        <input type="file" id="file-input" accept=".pdf,.epub"/>
      </label>
      <div id="file-info"></div>
      <button id="clear-btn" title="Clear file">Ã—</button>

      <div class="controls">
        <button class="length-btn" data-length="short">Short</button>
        <button class="length-btn active" data-length="medium">Medium</button>
        <button class="length-btn" data-length="long">Long</button>
      </div>
      <button id="summarize-btn" disabled>Summarize</button>
    </div>
  </div>

  <!-- Loader -->
  <div id="loading">
    <div class="spinner"></div>
  </div>

  <!-- Summary Modal -->
  <div id="summary-modal">
    <div class="modal-header">
      <span>Summary</span>
      <button class="close-btn" id="modal-close">&times;</button>
    </div>
    <div class="modal-body" id="summary-content"></div>
    <div class="modal-footer">
      <button id="copy-btn">Copy</button>
      <button id="download-btn">Download</button>
    </div>
  </div>

  <script>
    // Elements
    const DZ    = document.getElementById('drop-zone');
    const FI    = document.getElementById('file-info');
    const IN    = document.getElementById('file-input');
    const CLR   = document.getElementById('clear-btn');
    const LBS   = document.querySelectorAll('.length-btn');
    const BTN   = document.getElementById('summarize-btn');
    const LD    = document.getElementById('loading');
    const MOD   = document.getElementById('summary-modal');
    const MC    = document.getElementById('modal-close');
    const MB    = document.getElementById('summary-content');
    const CP    = document.getElementById('copy-btn');
    const DL    = document.getElementById('download-btn');

    let file=null, summary='', length='medium';

    // File handling
    function handleFile(f){
      file = f;
      FI.textContent = `ðŸ“„ ${f.name} â€” ${(f.size/1e6).toFixed(2)} MB`;
      FI.classList.add('visible');
      CLR.style.visibility='visible';
      BTN.disabled = false;
    }
    ['dragenter','dragover'].forEach(e=>
      DZ.addEventListener(e,ev=>{ev.preventDefault(); DZ.classList.add('dragover')})
    );
    ['drop','dragleave'].forEach(e=>
      DZ.addEventListener(e,ev=>{ev.preventDefault(); DZ.classList.remove('dragover')})
    );
    DZ.addEventListener('drop',ev=>{
      if(ev.dataTransfer.files.length) handleFile(ev.dataTransfer.files[0]);
    });
    DZ.addEventListener('click', ()=>IN.click());
    IN.addEventListener('change',()=>{
      if(IN.files[0]) handleFile(IN.files[0]);
    });
    CLR.addEventListener('click',()=>{
      file=null; FI.textContent=''; CLR.style.visibility='hidden';
      BTN.disabled=true;
    });

    // Length toggles
    LBS.forEach(b=>{
      b.addEventListener('click',()=>{
        LBS.forEach(x=>x.classList.remove('active'));
        b.classList.add('active');
        length = b.dataset.length;
      });
    });

    // Summarize
    BTN.addEventListener('click',async()=>{
      if(!file) return;
      BTN.disabled=true; LD.classList.add('show');
      MB.textContent='';

      const fd = new FormData();
      fd.append('file', file);
      fd.append('length', length);

      try{
        const res = await fetch('https://book-summarizer-backend.onrender.com/upload',{
          method:'POST',body:fd
        });
        const js  = await res.json();
        summary = js.summary||js.excerpt||'No summary';
        MB.textContent = summary;
        MOD.classList.add('show');
      }catch(e){
        console.error(e);
        alert('Summarization failed.');
      }finally{
        LD.classList.remove('show');
        BTN.disabled=false;
      }
    });

    // Modal
    MC.onclick = ()=>MOD.classList.remove('show');
    window.addEventListener('keyup',e=>{
      if(e.key==='Escape') MOD.classList.remove('show');
    });
    window.addEventListener('click',e=>{
      if(e.target===MOD) MOD.classList.remove('show');
    });

    // Copy / Download
    CP.addEventListener('click',()=>{
      navigator.clipboard.writeText(summary)
        .then(()=>alert('Copied!'))
        .catch(()=>alert('Failed to copy.'));
    });
    DL.addEventListener('click',()=>{
      const blob = new Blob([summary],{type:'text/plain'});
      const url  = URL.createObjectURL(blob);
      const a    = document.createElement('a');
      a.href     = url;
      a.download = (file?.name||'summary')+'.txt';
      a.click();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
