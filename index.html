<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>AI Book Summarizer</title>
  <style>
    :root {
      --bg-start:   #0f0f0f;
      --bg-end:     #121212;
      --window-bg:  #1a1a1a;
      --fg:         #ffffff;
      --muted:      #bbbbbb;
      --border:     #ffffff;
    }
    *,*::before,*::after { box-sizing:border-box; margin:0; padding:0 }
    body {
      background: linear-gradient(180deg, var(--bg-start), var(--bg-end));
      color: var(--fg);
      font-family: 'JetBrains Mono', monospace;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      text-align: center;
    }
    .panel {
      width: 360px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }
    h1 {
      font-size: 2.6rem;
      font-weight: 700;
      letter-spacing: 0.5px;
    }
    p {
      font-size: 1rem;
      color: var(--muted);
      margin-top: -0.2rem;
      margin-bottom: 0.5rem;
    }
    #drop-zone {
      position: relative;
      width: 100%;
      padding: 2rem;
      background: var(--window-bg);
      border: 3px dashed var(--border);
      border-radius: 6px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
      cursor: pointer;
      transition: background .2s, border-color .2s;
    }
    #drop-zone:hover, #drop-zone:focus-within {
      background: rgba(255,255,255,0.1);
      border-color: var(--border);
    }
    #drop-zone svg {
      width: 48px; height: 48px;
      fill: var(--muted);
      transition: fill .2s;
    }
    #drop-zone:hover svg, #drop-zone:focus-within svg {
      fill: var(--fg);
    }
    #drop-zone input {
      position: absolute; top:0; left:0;
      width:100%; height:100%; opacity:0;
      cursor:pointer;
    }
    .microcopy {
      font-size: .85rem;
      color: var(--muted);
      margin-top: -0.5rem;
      margin-bottom: 0;
    }
    #file-info {
      font-size: .9rem;
      color: var(--muted);
      width: 100%;
      text-align: left;
      word-break: break-all;
    }
    #clear-btn {
      background:none; border:none;
      color:#ff6b6b; font-size:1.2rem;
      cursor:pointer; visibility:hidden;
      align-self:flex-end;
    }
    #file-info:not(:empty) + #clear-btn {
      visibility:visible;
    }
    .controls {
      display: flex; gap: .6rem; width:100%;
      margin-top: .25rem;
    }
    .length-btn {
      flex:1; padding:.6rem;
      border:1px solid var(--fg);
      background:var(--window-bg);
      color:var(--fg); font-size:1rem;
      cursor:pointer; transition:background .2s;
    }
    .length-btn:hover {
      background:rgba(255,255,255,0.1);
    }
    .length-btn.active {
      background:var(--fg);
      color:var(--bg-start);
    }
    .primary-btn {
      width:100%; padding:1rem;
      margin-top:0;
      background:var(--fg);
      color:var(--bg-start);
      border:1px solid var(--fg);
      border-radius:6px;
      font-size:1.2rem; font-weight:700;
      cursor:pointer;
      transition:transform .1s,box-shadow .2s,opacity .2s;
    }
    .primary-btn:hover {
      transform:scale(1.02);
      box-shadow:0 4px 12px rgba(255,255,255,0.2);
    }
    .primary-btn:active {
      transform:scale(.98);
    }
    .primary-btn:disabled {
      opacity:.5; cursor:not-allowed;
    }
    .secondary-btn {
      width:100%; padding:1rem;
      background:transparent;
      border:1px solid var(--fg);
      color:var(--fg);
      font-size:1rem; border-radius:6px;
      cursor:pointer; transition:background .2s,transform .1s;
    }
    .secondary-btn:hover {
      background:rgba(255,255,255,0.1);
      transform:scale(1.02);
    }
    #loading-overlay {
      position:fixed;top:0;left:0;
      width:100%;height:100%;
      background:rgba(0,0,0,0.8);
      display:flex;justify-content:center;align-items:center;
      visibility:hidden;opacity:0;
      transition:opacity .2s; z-index:20;
    }
    #loading-overlay.show {
      visibility:visible;opacity:1;
    }
    .spinner {
      border:8px solid var(--muted);
      border-top:8px solid var(--fg);
      border-radius:50%;
      width:60px; height:60px;
      animation:spin .8s linear infinite;
    }
    @keyframes spin { to{transform:rotate(360deg)} }
    /* landscape modal */
    #summary-modal {
      position:fixed; top:50%; left:50%;
      transform:translate(-50%,-50%);
      width: 80%; max-width: 800px;
      height: 60vh; max-height: 60vh;
      background: var(--window-bg);
      border-radius:8px;
      box-shadow:0 8px 24px rgba(0,0,0,0.6);
      display:flex; flex-direction:column;
      visibility:hidden; opacity:0;
      transition:opacity .2s;
      z-index:30;
    }
    #summary-modal.show {
      visibility:visible; opacity:1;
    }
    .modal-header {
      padding:1rem 1.5rem;
      border-bottom:1px solid var(--border);
      display:flex; justify-content:space-between; align-items:center;
    }
    .modal-header h2 {
      font-size:1.6rem; font-weight:700; color:var(--fg);
    }
    .close-btn {
      background:none; border:none;
      font-size:1.5rem; cursor:pointer; color:var(--fg);
    }
    #summary-content {
      flex:1; overflow-y:auto;
      padding:1.5rem;
      font-size:1rem; line-height:1.6;
      color:#eee; text-align:left;
      white-space: normal;
    }
    .modal-footer {
      padding:1rem 1.5rem;
      border-top:1px solid var(--border);
      display:flex; justify-content:flex-end; gap:1rem;
    }
    .modal-footer button {
      padding:.75rem 1.25rem;
      background:var(--fg);
      color:var(--bg-start);
      border:1px solid var(--fg);
      border-radius:4px;
      font-size:1rem; cursor:pointer;
      transition:transform .1s,box-shadow .2s;
    }
    .modal-footer button:hover {
      transform:scale(1.02);
      box-shadow:0 4px 12px rgba(255,255,255,0.2);
    }
    footer {
      position:fixed; bottom:0; left:50%;
      transform:translateX(-50%);
      width:100%; max-width:360px;
      padding:.6rem 0;
      border-top:1px solid var(--border);
      background:var(--bg-end);
      color:rgba(255,255,255,0.85);
      font-size:.75rem; text-align:center;
      z-index:10;
    }
  </style>
</head>
<body>

  <div class="panel">
    <h1>AI Book Summarizer</h1>
    <p>Summarize any book in minutes.</p>

    <label id="drop-zone">
      <svg viewBox="0 0 24 24">
        <path d="M19 9h-4V3H9v6H5l7 7 7-7z"/>
        <path d="M5 18h14v2H5z"/>
      </svg>
      <span>Click or drop PDF/EPUB</span>
      <input type="file" id="file-input" accept=".pdf,.epub"/>
    </label>

    <div class="microcopy">Max 20 MB â€¢ PDF / EPUB</div>
    <div id="file-info" role="status"></div>
    <button id="clear-btn">Ã—</button>

    <div class="controls" id="length-control" role="radiogroup">
      <button class="length-btn" data-length="short">Short</button>
      <button class="length-btn active" data-length="medium">Medium</button>
      <button class="length-btn" data-length="long">Long</button>
    </div>

    <button id="summarize-btn" class="primary-btn" disabled>Summarize</button>
    <button class="secondary-btn" onclick="window.location='sample.pdf'">Sample PDF</button>
  </div>

  <div id="loading-overlay"><div class="spinner"></div></div>

  <div id="summary-modal" role="dialog" aria-modal="true">
    <div class="modal-header">
      <h2>Summary</h2>
      <button class="close-btn" id="modal-close">Ã—</button>
    </div>
    <div id="summary-content"></div>
    <div class="modal-footer">
      <button id="copy-btn">Copy</button>
      <button id="download-btn">Download</button>
    </div>
  </div>

  <footer>Â© 2025 | Built by You</footer>

  <script>
    const dz = document.getElementById('drop-zone'),
          fi = document.getElementById('file-input'),
          fo = document.getElementById('file-info'),
          cb = document.getElementById('clear-btn'),
          lb = document.querySelectorAll('.length-btn'),
          sb = document.getElementById('summarize-btn'),
          lo = document.getElementById('loading-overlay'),
          md = document.getElementById('summary-modal'),
          mc = document.getElementById('modal-close'),
          sc = document.getElementById('summary-content'),
          cp = document.getElementById('copy-btn'),
          dl = document.getElementById('download-btn');
    let file, sum, len = 'medium';

    function handleFile(f) {
      file = f;
      fo.textContent = `ðŸ“„ ${f.name} (${(f.size/1e6).toFixed(2)} MB)`;
      sb.disabled = false;
      cb.style.visibility = 'visible';
    }

    ['dragenter','dragover'].forEach(e =>
      dz.addEventListener(e, ev => { ev.preventDefault(); dz.classList.add('dragover'); })
    );
    ['dragleave','drop'].forEach(e =>
      dz.addEventListener(e, ev => { ev.preventDefault(); dz.classList.remove('dragover'); })
    );
    dz.addEventListener('drop', ev => {
      if (ev.dataTransfer.files.length) handleFile(ev.dataTransfer.files[0]);
    });
    dz.addEventListener('click', () => fi.click());
    fi.addEventListener('change', () => {
      if (fi.files.length) handleFile(fi.files[0]);
    });

    cb.addEventListener('click', () => {
      file = null; fi.value = ''; fo.textContent = '';
      sb.disabled = true; cb.style.visibility = 'hidden';
    });

    lb.forEach(btn => btn.addEventListener('click', () => {
      lb.forEach(x => x.classList.remove('active'));
      btn.classList.add('active');
      len = btn.dataset.length;
    }));

    sb.addEventListener('click', async () => {
      if (!file) return;
      sb.disabled = true;
      lo.classList.add('show');
      sc.textContent = '';
      md.classList.remove('show');

      const fd = new FormData();
      fd.append('file', file);
      fd.append('length', len);

      try {
        const res = await fetch('https://book-summarizer-backend.onrender.com/upload', {
          method: 'POST',
          body: fd
        });
        const data = await res.json();
        sum = data.summary || data.excerpt || 'No summary available.';
        sc.textContent = sum;
        md.classList.add('show');
      } catch (e) {
        console.error(e);
      } finally {
        lo.classList.remove('show');
        sb.disabled = false;
      }
    });

    mc.addEventListener('click', () => md.classList.remove('show'));
    window.addEventListener('click', e => { if (e.target === md) md.classList.remove('show'); });
    window.addEventListener('keydown', e => { if (e.key === 'Escape') md.classList.remove('show'); });

    cp.addEventListener('click', () => navigator.clipboard.writeText(sum));
    dl.addEventListener('click', () => {
      const blob = new Blob([sum], { type: 'text/plain' }),
            url  = URL.createObjectURL(blob),
            a    = document.createElement('a');
      a.href     = url;
      a.download = (file?.name || 'summary') + '.txt';
      a.click();
      URL.revokeObjectURL(url);
    });
  </script>

</body>
</html>
